Meta:
    Aliases:
        MODE_UR: &MODE_UR 'u=rX,g=,o='
        MODE_URW: &MODE_URW 'u=rwX,g=,o='
        MODE_UR_GR: &MODE_UR_GR 'u=rX,g=rX,o='
        MODE_URW_GR: &MODE_URW_GR 'u=rwX,g=rX,o='
        MODE_URW_GRW: &MODE_URW_GRW 'u=rwX,g=rwX,o='
        MODE_URW_GR_OR: &MODE_URW_GR_OR 'u=rwX,g=rX,o=rX'

        MIB_384: &MIB_384 402653184
        MIB_512: &MIB_512 536870912
        MIB_768: &MIB_768 805306368
        MIB_1024: &MIB_1024 1073741824
        MIB_1536: &MIB_1536 1610612736
        MIB_2048: &MIB_2048 2147483648
        MIB_3584: &MIB_3584 3758096384
        MIB_4096: &MIB_4096 4294967296
        MIB_8192: &MIB_8192 8589934592

        TMP_MIB_64: &TMP_MIB_64 'size=64M,nr_inodes=20K,mode=700,rw,nosuid,nodev,noexec,async,noatime'
        TMP_MIB_64_755: &TMP_MIB_64_755 'size=64M,nr_inodes=20K,mode=755,rw,nosuid,nodev,noexec,async,noatime'
        TMP_MIB_64_EXEC: &TMP_MIB_64_EXEC 'size=64M,nr_inodes=20K,mode=700,rw,nosuid,nodev,exec,async,noatime'
        TMP_MIB_128: &TMP_MIB_128 'size=128M,nr_inodes=40K,mode=700,rw,nosuid,nodev,noexec,async,noatime'
        TMP_MIB_256: &TMP_MIB_256 'size=256M,nr_inodes=80K,mode=700,rw,nosuid,nodev,noexec,async,noatime'

    BindRoot: '/srv/docker'

    API:
        Default:
            StopSignal: 'SIGTERM'
            HostConfig:
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                MemoryReservation: *MIB_768
                CpuShares: 1024 # Kernel default
                CapDrop:
                    - 'ALL'
                PublishAllPorts: false
                Dns:
                    - '10.7.1.1'
                NetworkMode: 'none'
                ReadonlyRootfs: true
                SecurityOpt:
                    - 'no-new-privileges'

################
#  CONTAINERS  #
################

'acoustid':
    Image: 'nfnty/arch-acoustid:latest'
    UGID: 370000

    Names:
        'acoustid': null

    Paths:
        'config':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                Binds:
                    - 'config/acoustid.conf:/opt/acoustid-server/acoustid.conf:ro'

'acoustid-index':
    Image: 'nfnty/arch-acoustid-index:latest'
    UGID: 390000

    Names:
        'acoustid-index': null

    Paths:
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                Binds:
                    - 'lib:/var/lib/acoustid-index:rw'


'avahi':
    Image: 'nfnty/arch-avahi:latest'
    UGID: 310000

    Names:
        'avahi': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            Hostname: null
            HostConfig:
                CpuShares: 2048
                NetworkMode: 'host'
                Dns: null
                Binds:
                    - 'etc:/etc/avahi:ro'
                Tmpfs:
                    '/run/avahi-daemon': *TMP_MIB_64

'bitcoin-classic':
    Image: 'nfnty/arch-bitcoin-classic:latest'
    UGID: 330000

    Names:
        'bitcoin-classic': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                CpuShares: 256
                Binds:
                    - 'etc:/etc/bitcoin:ro'
                    - 'lib:/var/lib/bitcoin:rw'

'bootstrap':
    Image: 'nfnty/arch-bootstrap:latest'
    UGID: 0

    Paths:
        'archive':
            Mode: *MODE_URW
        'gnupg':
            Mode: *MODE_URW
            Managed: true

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                CpuShares: 512
                CapAdd:
                    - 'CHOWN'
                    - 'DAC_OVERRIDE'
                    - 'SYS_CHROOT'
                NetworkMode: 'bridge'
                Dns:
                    - '10.7.2.1'
                Binds:
                    - 'archive:/var/lib/bootstrap/archive:rw'
                    - 'gnupg:/var/lib/bootstrap/gnupg:rw'
                Tmpfs:
                    '/tmp': 'size=512M,nr_inodes=200K,mode=700,rw,nosuid,nodev,exec,async,noatime'

'builder':
    Image: 'nfnty/arch-builder:latest'
    UGID: 99999

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
            Exclude:
                - 'pkg'
        'lib/gnupg':
            Managed: true
            ManagedOpts:
                Delete: false
        'lib/pkg':
            Mode: *MODE_URW_GR
        'log':
            Mode: *MODE_URW
        'pkgbuild':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                CpuShares: 512
                CapAdd:
                    - 'FOWNER'
                    - 'SETGID'
                    - 'SETUID'
                    - 'SYS_CHROOT'
                    - 'SYS_RESOURCE'
                NetworkMode: 'bridge'
                Dns:
                    - '10.7.2.1'
                ReadonlyRootfs: false
                Binds:
                    - 'etc/makepkg.conf:/etc/makepkg.conf:ro'
                    - 'lib:/var/lib/builder:rw'
                    - 'log:/var/log/builder:rw'
                    - 'pkgbuild:/mnt/pkgbuild:rw'
                SecurityOpt: null

'cadvisor':
    Image: 'nfnty/arch-cadvisor:latest'
    UGID: 0

    Names:
        'cadvisor': null

    API:
        'Normal':
            Cmd: ['-docker', 'unix:///mnt/docker.sock']
            HostConfig:
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                MemoryReservation: *MIB_768
                CpuShares: 2048
                CapAdd:
                    - 'DAC_OVERRIDE'
                Binds:
                    - '/:/rootfs:ro'
                    - '/run/docker.sock:/mnt/docker.sock:rw'
                    - '/sys:/sys:ro'
                    - '/var/lib/docker:/var/lib/docker:ro'
                Tmpfs:
                    '/tmp': *TMP_MIB_64

'clamav':
    Image: 'nfnty/arch-clamav:latest'
    UGID: 400000

    Names:
        'clamav':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/clamav:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                Binds:
                    - 'etc:/etc/clamav:ro'
                    - 'lib:/var/lib/clamav:rw'
                Tmpfs:
                    '/tmp': *TMP_MIB_256

'clamav-updater':
    Image: 'nfnty/arch-clamav:latest'
    UGID: 400000

    Names:
        'clamav-updater': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            Entrypoint: ["/usr/bin/freshclam", "--daemon", "--stdout"]
            HostConfig:
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                MemoryReservation: *MIB_768
                Binds:
                    - 'etc:/etc/clamav:ro'
                    - '/srv/docker/clamav/lib:/var/lib/clamav:rw'


'dovecot':
    Image: 'nfnty/arch-dovecot:latest'
    UGID: 220000

    Names:
        'dovecot':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/dovecot:/dev/log:rw'
                            - '/srv/ssl/letsencrypt/nfnty.se:/mnt/ssl:ro'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
        'lib/sieve':
            Managed: true
            ManagedOpts:
                Filter:
                    - 'protect *.svbin'

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                Binds:
                    - 'etc:/etc/dovecot:ro'
                    - 'lib:/var/lib/dovecot:rw'
                Tmpfs:
                    '/run/dovecot': *TMP_MIB_64_755
                    '/tmp': *TMP_MIB_64

'elasticsearch':
    Image: 'nfnty/arch-elasticsearch:latest'
    UGID: 110000

    Names:
        'elasticsearch': null

    Paths:
        'config':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
        'plugins':
            Mode: *MODE_UR

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                ExtraHosts:
                    - 'elasticsearch:127.0.0.1'
                Binds:
                    - 'config:/opt/elasticsearch/config:ro'
                    - 'lib:/var/lib/elasticsearch:rw'
                    - 'plugins:/opt/elasticsearch/plugins:ro'
                Tmpfs:
                    '/tmp': *TMP_MIB_64_EXEC

'emby':
    Image: 'nfnty/arch-emby:latest'
    UGID: 280000

    Names:
        'emby': null

    Paths:
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                Binds:
                    - 'lib:/var/lib/emby:rw'
                    - '/mnt/1/share/Anime:/mnt/Anime:rw'
                    - '/mnt/1/share/Home:/mnt/Home:rw'
                    - '/mnt/1/share/Movies:/mnt/Movies:rw'
                    - '/mnt/1/share/Series:/mnt/Series:rw'
                Tmpfs:
                    '/tmp': *TMP_MIB_64

'exim':
    Image: 'nfnty/arch-exim:latest'
    UGID: 250000

    Names:
        'exim':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/exim:/dev/log:rw'
                            - '/srv/ssl/letsencrypt/nfnty.se:/mnt/ssl:ro'

    Paths:
        'etc':
            Mode: *MODE_UR_GR
            User: 'root'
            Managed: true
            ManagedOpts:
                Filter:
                    - 'protect /ssl/dhparam.pem'
                    - 'exclude /domains'
        'etc/domains':
            Managed: true
            ManagedOpts:
                Reload: false
        'spool':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'etc:/etc/mail:ro'
                    - 'spool:/var/spool/exim:rw'

'grafana':
    Image: 'nfnty/arch-grafana:latest'
    UGID: 360000

    Names:
        'grafana': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                Binds:
                    - 'etc:/etc/grafana:ro'
                    - 'lib:/var/lib/grafana:rw'

'heka':
    Image: 'nfnty/arch-heka:latest'
    UGID: 290000

    Names:
        'heka': null

    Paths:
        'cache':
            Mode: *MODE_URW
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                Binds:
                    - 'cache:/var/cache/hekad:rw'
                    - 'etc:/etc/heka:ro'

'hostapd':
    Image: 'nfnty/arch-hostapd:latest'
    UGID: 270000

    Names:
        'hostapd':
            API:
                'Normal':
                    Entrypoint:
                        - '/etc/hostapd/wlan_24n0/hostapd.conf'
                        - '/etc/hostapd/wlan_50n0/hostapd.conf'
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/hostapd:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            Hostname: null
            Entrypoint:
                - '/usr/bin/hostapd'
            HostConfig:
                CpuShares: 2048
                CapAdd:
                    - 'NET_ADMIN'
                    - 'NET_RAW'
                NetworkMode: 'host'
                Dns: null
                Binds:
                    - 'etc:/etc/hostapd:ro'

'influxdb':
    Image: 'nfnty/arch-influxdb:latest'
    UGID: 350000

    Names:
        'influxdb': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                CpuShares: 2048
                Binds:
                    - 'etc:/etc/influxdb:ro'
                    - 'lib:/var/lib/influxdb:rw'
        'Setup':
            Entrypoint: ['/usr/bin/bash', '-c', '/usr/bin/influxd config > /etc/influxdb/config.toml']
            HostConfig:
                Binds:
                    - 'etc:/etc/influxdb:rw'

'kea-dhcp4':
    Image: 'nfnty/arch-kea:latest'
    UGID: 260000

    Names:
        'kea-dhcp4':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/kea-dhcp4:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            Hostname: null
            HostConfig:
                CpuShares: 2048
                CapAdd:
                    - 'NET_BIND_SERVICE'
                    - 'NET_RAW'
                NetworkMode: 'host'
                Dns: null
                Binds:
                    - 'etc:/etc/kea:ro'
                    - 'lib:/var/lib/kea:rw'
                Tmpfs:
                    '/run/kea': *TMP_MIB_64

'kibana':
    Image: 'nfnty/arch-kibana:latest'
    UGID: 120000

    Names:
        'kibana': null

    Paths:
        'config':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            Env:
                - 'NODE_OPTIONS=--max-old-space-size=250'
            HostConfig:
                CpuShares: 512
                Binds:
                    - 'config:/opt/kibana/config:ro'
                Tmpfs:
                    '/tmp': *TMP_MIB_64

'certbot':
    Image: 'nfnty/arch-certbot:latest'
    UGID: 99998

    Paths:
        'etc':
            Mode: *MODE_URW
            Exclude:
                - 'cli.ini'
        'etc/cli.ini':
            Type: 'Regular'
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
        'log':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                NetworkMode: 'bridge'
                Dns:
                    - '10.7.2.1'
                Binds:
                    - 'etc:/etc/letsencrypt:rw'
                    - 'lib:/var/lib/letsencrypt:rw'
                    - 'log:/var/log/letsencrypt:rw'
                    - '/srv/docker/nginx-proxy-wan/webroot/letsencrypt:/mnt/webroot:rw'

'logstash':
    Image: 'nfnty/arch-logstash:latest'
    UGID: 130000

    Names:
        'logstash': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                ExtraHosts:
                    - 'logstash:127.0.0.1'
                Binds:
                    - 'etc:/etc/logstash:ro'
                    - 'lib:/var/lib/logstash:rw'
                    - '/var/log/ulogd:/mnt/ulogd:ro'

'nginx':
    Image: 'nfnty/arch-nginx:latest'
    UGID: 160000

    Names:
        'nginx-proxy-wan':
            Paths:
                'webroot':
                    Exclude:
                        - 'letsencrypt'
                'webroot/letsencrypt':
                    Mode: *MODE_URW_GRW
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/nginx-proxy-wan:/dev/log:rw'
                            - '/srv/ssl/letsencrypt/nfnty.se:/mnt/ssl:ro'

        'nginx-proxy':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/nginx-proxy:/dev/log:rw'

        'nginx-mirror':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/builder/lib/pkg:/mnt/nfnty:ro'
                            - '/srv/mirror:/mnt/mirror:ro'
                            - '/srv/docker/rsyslog/run/nginx-mirror:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
            ManagedOpts:
                Filter:
                    - 'protect /ssl/dhparam.pem'
        'lib':
            Mode: *MODE_URW
        'webroot':
            Mode: *MODE_UR

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'etc:/etc/nginx:ro'
                    - 'lib:/var/lib/nginx:rw'
                    - 'webroot:/srv/http:ro'
                Tmpfs:
                    '/run/nginx': *TMP_MIB_64

'ntp':
    Image: 'nfnty/arch-ntp:latest'
    UGID: 230000

    Names:
        'ntp': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_512
                MemorySwap: *MIB_1024
                MemoryReservation: *MIB_384
                CpuShares: 2048
                CapAdd:
                    - 'IPC_LOCK'
                    - 'NET_BIND_SERVICE'
                    - 'SYS_TIME'
                Binds:
                    - 'etc:/etc/ntp:ro'
                    - 'lib:/var/lib/ntp:rw'
                SecurityOpt:
                    - 'no-new-privileges'
                    - "seccomp={{ lookup('file', role_path + '/files/ntp/seccomp.json') }}"

'openhab':
    Image: 'nfnty/arch-openhab-telldus:latest'
    UGID: 170000

    Names:
        'openhab': null

    Paths:
        'addons':
            Mode: *MODE_UR
            Managed: true
        'config':
            Mode: *MODE_UR
            Managed: true
        'etc_openhab':
            Mode: *MODE_UR
            Managed: true
        'etc_telldus':
            Mode: *MODE_UR
            Managed: true
        'lib_openhab':
            Mode: *MODE_URW
        'lib_telldus':
            Mode: *MODE_URW
        'webapps':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                Binds:
                    - 'addons:/opt/openhab/addons:ro'
                    - 'config:/opt/openhab/configurations:ro'
                    - 'etc_openhab:/opt/openhab/etc:ro'
                    - 'etc_telldus/tellstick.conf:/etc/tellstick.conf:ro'
                    - 'lib_openhab:/var/lib/openhab:rw'
                    - 'lib_telldus:/var/lib/telldus:rw'
                    - 'webapps:/opt/openhab/webapps/static:rw'
                Tmpfs:
                    '/tmp': *TMP_MIB_64_EXEC
                Devices:
                    - PathOnHost: '/dev/tellstickduo0'
                      PathInContainer: ''
                      CgroupPermissions: 'rw'

'openvpn':
    Image: 'nfnty/arch-openvpn:latest'
    UGID: 190000

    Names:
        'openvpn-admin-tcp':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/openvpn-admin-tcp:/dev/log:rw'

        'openvpn-admin-udp':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/openvpn-admin-udp:/dev/log:rw'

        'openvpn-home-tcp':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/openvpn-home-tcp:/dev/log:rw'

        'openvpn-home-udp':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/openvpn-home-udp:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR_GR
            Group: 'root'
            Managed: true
            ManagedOpts:
                Filter:
                    - 'protect /ssl/dhparam.pem'
                    - 'protect /ssl/ta.key'
        'lib':
            Mode: *MODE_URW_GRW
            Group: 'root'

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                CapAdd:
                    - 'NET_ADMIN'
                    - 'NET_RAW'
                    - 'SETGID'
                    - 'SETUID'
                Binds:
                    - 'etc:/etc/openvpn:ro'
                    - 'lib:/var/lib/openvpn:rw'
                Tmpfs:
                    '/tmp': 'size=32M,nr_inodes=10K,mode=770,rw,nosuid,nodev,noexec,async,noatime,gid=0'
                Devices:
                    - PathOnHost: '/dev/net/tun'
                      PathInContainer: '/dev/net/tun'
                      CgroupPermissions: 'rw'

        'Setup':
            Entrypoint: ['/usr/bin/openvpn', '--genkey', '--secret', '/etc/openvpn/ssl/ta.key']
            HostConfig:
                Binds:
                    - 'etc:/etc/openvpn:rw'

'owncloud':
    Image: 'nfnty/arch-owncloud:latest'
    UGID: 160000

    Names:
        'owncloud': null

    Paths:
        'apps':
            Mode: *MODE_URW
        'data':
            Mode: *MODE_URW
        'config':
            Mode: *MODE_URW
            Managed: true
        'etc_nginx':
            Mode: *MODE_UR
            Managed: true
        'etc_php':
            Mode: *MODE_UR
            Managed: true
        'lib_nginx':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'apps:/usr/share/webapps/owncloud/apps:rw'
                    - 'config:/usrshare/webapps/owncloud/config:rw'
                    - 'data:/usr/share/webapps/owncloud/data:rw'
                    - 'etc_nginx:/etc/nginx:ro'
                    - 'etc_php:/etc/php:ro'
                    - 'lib_nginx:/var/lib/nginx:rw'
                    - '/mnt/1/share:/mnt/1:rw'
                Tmpfs:
                    '/run/nginx': *TMP_MIB_64
                    '/run/php-fpm': *TMP_MIB_64
                    '/tmp': *TMP_MIB_64

'pimd':
    Image: 'nfnty/arch-pimd:latest'
    UGID: 300000

    Names:
        'pimd': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                CpuShares: 2048
                CapAdd:
                    - 'NET_ADMIN'
                    - 'NET_RAW'
                NetworkMode: 'host'
                Binds:
                    - 'etc/pimd.conf:/etc/pimd.conf:ro'
                Tmpfs:
                    '/var/run': *TMP_MIB_64

'plex':
    Image: 'nfnty/arch-plex:latest'
    UGID: 320000

    Names:
        'plex': null

    Paths:
        'lib':
            Mode: *MODE_URW
        'lib/data':
            Managed: true
            ManagedOpts:
                Delete: false

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                Binds:
                    - 'lib:/var/lib/plexmediaserver:rw'
                    - '/mnt/1/share/Anime:/mnt/Anime:ro'
                    - '/mnt/1/share/Home:/mnt/Home:ro'
                    - '/mnt/1/share/Movies:/mnt/Movies:ro'
                    - '/mnt/1/share/Series:/mnt/Series:ro'
                Tmpfs:
                    '/tmp': *TMP_MIB_64

'postgresql':
    Image: 'nfnty/arch-postgresql:latest'
    UGID: 180000

    Names:
        'postgresql': null

        'postgresql-acoustid':
            Image: 'nfnty/arch-postgresql-acoustid:latest'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
        'lib/data':
            Managed: true
            ManagedOpts:
                Delete: false

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                Binds:
                    - 'etc:/etc/postgres:ro'
                    - 'lib:/var/lib/postgres:rw'
                Tmpfs:
                    '/run/postgresql': *TMP_MIB_64

        'Setup':
            Entrypoint: ['/usr/bin/initdb']
            HostConfig:
                Binds:
                    - 'lib:/var/lib/postgres:rw'

'powerdns-recursor':
    Image: 'nfnty/arch-powerdns-recursor:latest'
    UGID: 240000

    Names:
        'powerdns-recursor': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                CpuShares: 2048
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'etc:/etc/powerdns:ro'
                    - '/srv/blacklists/domain:/mnt/blacklists:ro'
                Tmpfs:
                    '/run': *TMP_MIB_64

'prometheus':
    Image: 'nfnty/arch-prometheus:latest'
    UGID: 360000

    Names:
        'prometheus': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                CpuShares: 2048
                Binds:
                    - 'etc:/etc/prometheus:ro'
                    - 'lib:/var/lib/prometheus:rw'

'redis':
    Image: 'nfnty/arch-redis:latest'
    UGID: 380000

    Names:
        'redis-acoustid': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                Binds:
                    - 'etc/redis.conf:/etc/redis.conf:ro'
                    - 'lib:/var/lib/redis:rw'

'rspamd':
    Image: 'nfnty/arch-rspamd:latest'
    UGID: 410000

    Names:
        'rspamd': null

    Paths:
        'etc/rspamd.conf':
            Type: 'Regular'
            Mode: *MODE_UR
            Managed: true
        'etc/override.d':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                Binds:
                    - 'etc/rspamd.conf:/etc/rspamd/rspamd.conf:ro'
                    - 'etc/override.d:/etc/rspamd/override.d:ro'
                    - 'lib:/var/lib/rspamd:rw'

'rsyslog':
    Image: 'nfnty/arch-rsyslog:latest'
    UGID: 340000

    Names:
        'rsyslog': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'log':
            Mode: *MODE_URW_GR
        'run':
            Mode: *MODE_URW
            Exclude: '.*'

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                CpuShares: 2048
                Binds:
                    - 'etc/rsyslog.conf:/etc/rsyslog.conf:ro'
                    - 'log:/var/log/rsyslog:rw'
                    - 'run:/run:rw'

'samba':
    Image: 'nfnty/arch-samba:latest'
    UGID: 140000

    Names:
        'samba': null

    Paths:
        'cache':
            Mode: *MODE_URW_GR_OR
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                MemoryReservation: *MIB_1536
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'cache:/var/cache/samba:rw'
                    - 'etc:/etc/samba:ro'
                    - 'lib:/var/lib/samba:rw'
                    - '/mnt/1/share:/mnt/1:rw'
                Tmpfs:
                    '/run/samba': *TMP_MIB_64

'transmission':
    Image: 'nfnty/arch-transmission:latest'
    UGID: 100000

    Names:
        'transmission': null

    Paths:
        'lib':
            Mode: *MODE_URW
            Managed: true
            ManagedOpts:
                Delete: false
        'opt':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                MemoryReservation: *MIB_3584
                CpuShares: 512
                Binds:
                    - 'lib:/var/lib/transmission:rw'
                    - 'opt:/opt/transmission:ro'
                    - '/mnt/1/share/torrent:/mnt/torrent:rw'
