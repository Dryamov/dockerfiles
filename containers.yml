Meta:
    Aliases:
        MODE_UR: &MODE_UR 'u=rX,g=,o='
        MODE_URW: &MODE_URW 'u=rwX,g=,o='
        MODE_UR_GR: &MODE_UR_GR 'u=rX,g=rX,o='
        MODE_URW_GR: &MODE_URW_GR 'u=rwX,g=rX,o='
        MODE_URW_GRW: &MODE_URW_GRW 'u=rwX,g=rwX,o='
        MODE_URW_GR_OR: &MODE_URW_GR_OR 'u=rwX,g=rX,o=rX'

        MIB_448: &MIB_448 469762048  # 512MiB - 64MiB
        MIB_512: &MIB_512 536870912
        MIB_896: &MIB_896 939524096  # 1024MiB - 128MiB
        MIB_1024: &MIB_1024 1073741824
        MIB_1792: &MIB_1792 1879048192  # 2048MiB - 256MiB
        MIB_2048: &MIB_2048 2147483648
        MIB_3840: &MIB_3840 4026531840  # 4096MiB - 256MiB
        MIB_4096: &MIB_4096 4294967296
        MIB_7936: &MIB_7936 8321499136  # 8192MiB - 256MiB
        MIB_8192: &MIB_8192 8589934592
        MIB_16128: &MIB_16128 16911433728  # 16384MiB - 256MiB
        MIB_16384: &MIB_16384 17179869184
        MIB_32512: &MIB_32512 34091302912  # 32768MiB - 256MiB
        MIB_32768: &MIB_32768 34359738368

        CPU_1S: &CPU_1S 1000000
        CPU_2S: &CPU_2S 2000000
        CPU_3S: &CPU_3S 3000000
        CPU_4S: &CPU_4S 4000000
        CPU_5S: &CPU_5S 5000000
        CPU_6S: &CPU_6S 6000000
        CPU_7S: &CPU_7S 7000000
        CPU_8S: &CPU_8S 8000000

        TMP_MIB_64: &TMP_MIB_64 'size=64M,nr_inodes=20K,mode=700,rw,nosuid,nodev,noexec,async,noatime'
        TMP_MIB_64_755: &TMP_MIB_64_755 'size=64M,nr_inodes=20K,mode=755,rw,nosuid,nodev,noexec,async,noatime'
        TMP_MIB_64_EXEC: &TMP_MIB_64_EXEC 'size=64M,nr_inodes=20K,mode=700,rw,nosuid,nodev,exec,async,noatime'
        TMP_MIB_128: &TMP_MIB_128 'size=128M,nr_inodes=40K,mode=700,rw,nosuid,nodev,noexec,async,noatime'
        TMP_MIB_256: &TMP_MIB_256 'size=256M,nr_inodes=80K,mode=700,rw,nosuid,nodev,noexec,async,noatime'

    BindRoot: '/srv/docker'

    API:
        Default:
            StopSignal: 'SIGTERM'
            HostConfig:
                MemoryReservation: *MIB_896
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                CpuShares: 1024  # Kernel default
                CpuPeriod: *CPU_1S
                CpuQuota: *CPU_2S
                CapDrop:
                    - 'ALL'
                PublishAllPorts: false
                Sysctls:
                    'net.ipv6.conf.all.disable_ipv6': '0'
                Dns:
                    - "{{ network['devices']['vbr_docker0']['gateway4'] }}"
                NetworkMode: 'static'
                ReadonlyRootfs: true
                SecurityOpt:
                    - 'no-new-privileges'

################
#  CONTAINERS  #
################

'acoustid':
    Image: 'nfnty/arch-acoustid:latest'
    UGID: 880037

    Names:
        'acoustid':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['acoustid'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['acoustid'] }}"

    Paths:
        'config':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                Binds:
                    - 'config/acoustid.conf:/opt/acoustid-server/acoustid.conf:ro'

'acoustid-index':
    Image: 'nfnty/arch-acoustid-index:latest'
    UGID: 880039

    Names:
        'acoustid-index':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['acoustid-index'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['acoustid-index'] }}"

    Paths:
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuQuota: *CPU_4S
                Binds:
                    - 'lib:/var/lib/acoustid-index:rw'


'avahi':
    Image: 'nfnty/arch-avahi:latest'
    UGID: 880031

    Names:
        'avahi': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            Hostname: null
            HostConfig:
                CpuShares: 2048
                NetworkMode: 'host'
                Dns: null
                Binds:
                    - 'etc:/etc/avahi:ro'
                Tmpfs:
                    '/run/avahi-daemon': *TMP_MIB_64

'bitcoin':
    Image: 'nfnty/arch-bitcoin-unlimited:latest'
    UGID: 880033

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuShares: 256
                CpuQuota: *CPU_4S
                Binds:
                    - 'etc:/etc/bitcoin:ro'
                    - 'lib:/var/lib/bitcoin:rw'

'bootstrap':
    Image: 'nfnty/arch-bootstrap:latest'
    UGID: 0

    Paths:
        'archive':
            Mode: *MODE_URW
        'gnupg':
            Mode: *MODE_URW
            Managed: true

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuShares: 512
                CpuQuota: *CPU_4S
                CapAdd:
                    - 'CHOWN'
                    - 'DAC_OVERRIDE'
                    - 'SYS_CHROOT'
                NetworkMode: 'bridge'
                Dns:
                    - "{{ network['devices']['vbr_docker1']['gateway4'] }}"
                Binds:
                    - 'archive:/var/lib/bootstrap/archive:rw'
                    - 'gnupg:/var/lib/bootstrap/gnupg:rw'
                Tmpfs:
                    '/tmp': 'size=512M,nr_inodes=200K,mode=700,rw,nosuid,nodev,exec,async,noatime'

'builder':
    Image: 'nfnty/arch-builder:latest'
    UGID: 880001

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
            Exclude:
                - 'pkg'
        'lib/gnupg':
            Managed: true
            ManagedOpts:
                Delete: false
        'lib/pkg':
            Mode: *MODE_URW_GR
        'log':
            Mode: *MODE_URW
        'pkgbuild':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuShares: 512
                CpuQuota: *CPU_4S
                CapAdd:
                    - 'FOWNER'
                    - 'SETGID'
                    - 'SETUID'
                    - 'SYS_CHROOT'
                    - 'SYS_RESOURCE'
                NetworkMode: 'bridge'
                Dns:
                    - "{{ network['devices']['vbr_docker1']['gateway4'] }}"
                ReadonlyRootfs: false
                Binds:
                    - 'etc/makepkg.conf:/etc/makepkg.conf:ro'
                    - 'lib:/var/lib/builder:rw'
                    - 'log:/var/log/builder:rw'
                    - 'pkgbuild:/mnt/pkgbuild:rw'
                SecurityOpt: null
                Init: true

'cadvisor':
    Image: 'nfnty/arch-cadvisor:latest'
    UGID: 0

    Names:
        'cadvisor':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['cadvisor'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['cadvisor'] }}"

    API:
        'Normal':
            Cmd: ['-docker', 'unix:///mnt/docker.sock', '-disable_metrics', 'disk,tcp']
            HostConfig:
                MemoryReservation: *MIB_896
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                CpuShares: 2048
                CapAdd:
                    - 'DAC_OVERRIDE'
                Binds:
                    - '/:/rootfs:ro'
                    - '/run/docker.sock:/mnt/docker.sock:rw'
                    - '/sys:/sys:ro'
                    - '/var/lib/docker:/var/lib/docker:ro'
                Tmpfs:
                    '/tmp': *TMP_MIB_64

'clamav':
    Image: 'nfnty/arch-clamav:latest'
    UGID: 880040

    Names:
        'clamav':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['clamav'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['clamav'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/clamav:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                Binds:
                    - 'etc:/etc/clamav:ro'
                    - 'lib:/var/lib/clamav:rw'
                Tmpfs:
                    '/tmp': *TMP_MIB_256

'clamav-updater':
    Image: 'nfnty/arch-clamav:latest'
    UGID: 880040

    Names:
        'clamav-updater':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['clamav-updater'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['clamav-updater'] }}"

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            Entrypoint: ['/usr/bin/freshclam', '--daemon', '--stdout']
            HostConfig:
                MemoryReservation: *MIB_896
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                Binds:
                    - 'etc:/etc/clamav:ro'
                    - '/srv/docker/clamav/lib:/var/lib/clamav:rw'

'dnsdist':
    Image: 'nfnty/arch-dnsdist:latest'
    UGID: 880045

    Names:
        'dnsdist':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['dnsdist'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['dnsdist'] }}"

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CpuShares: 2048
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'etc:/etc/dnsdist:ro'

'dovecot':
    Image: 'nfnty/arch-dovecot:latest'
    UGID: 880022

    Names:
        'dovecot':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['dovecot'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['dovecot'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/dovecot:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
        'lib/sieve':
            Managed: true
            ManagedOpts:
                Filter:
                    - 'protect *.svbin'
                    - 'protect *.log'
                Reload: false

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                Binds:
                    - 'etc:/etc/dovecot:ro'
                    - 'lib:/var/lib/dovecot:rw'
                Tmpfs:
                    '/run/dovecot': *TMP_MIB_64_755
                    '/tmp': *TMP_MIB_64

'elasticsearch':
    Image: 'nfnty/arch-elasticsearch:latest'
    UGID: 880011

    Names:
        'elasticsearch':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['elasticsearch'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['elasticsearch'] }}"

    Paths:
        'config':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
        'plugins':
            Mode: *MODE_UR

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuQuota: *CPU_4S
                ExtraHosts:
                    - 'elasticsearch:127.0.0.1'
                Binds:
                    - 'config:/opt/elasticsearch/config:ro'
                    - 'lib:/var/lib/elasticsearch:rw'
                    - 'plugins:/opt/elasticsearch/plugins:ro'
                Tmpfs:
                    '/tmp': *TMP_MIB_64_EXEC

'emby':
    Image: 'nfnty/arch-emby:latest'
    UGID: 880028

    Names:
        'emby':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['emby'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['emby'] }}"

    Paths:
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuQuota: *CPU_4S
                Binds:
                    - 'lib:/var/lib/emby:rw'
                    - '/mnt/1/share/Anime:/mnt/Anime:rw'
                    - '/mnt/1/share/Home:/mnt/Home:rw'
                    - '/mnt/1/share/Movies:/mnt/Movies:rw'
                    - '/mnt/1/share/Series:/mnt/Series:rw'
                Tmpfs:
                    '/tmp': *TMP_MIB_64
                Init: true

'exim':
    Image: 'nfnty/arch-exim:latest'
    UGID: 880025

    Names:
        'exim':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['exim'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['exim'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/exim:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR_GR
            User: 'root'
            Managed: true
            ManagedOpts:
                Filter:
                    - 'protect /ssl/dhparam.pem'
                    - 'exclude /domains'
        'etc/domains':
            Managed: true
            ManagedOpts:
                Reload: false
        'spool':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'etc:/etc/mail:ro'
                    - 'spool:/var/spool/exim:rw'

'grafana':
    Image: 'nfnty/arch-grafana:latest'
    UGID: 880021

    Names:
        'grafana':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['grafana'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['grafana'] }}"

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CpuQuota: *CPU_4S
                Binds:
                    - 'etc:/etc/grafana:ro'
                    - 'lib:/var/lib/grafana:rw'

'heka':
    Image: 'nfnty/arch-heka:latest'
    UGID: 880029

    Paths:
        'cache':
            Mode: *MODE_URW
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                Binds:
                    - 'cache:/var/cache/hekad:rw'
                    - 'etc:/etc/heka:ro'

'hostapd':
    Image: 'nfnty/arch-hostapd:latest'
    UGID: 880027

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            Hostname: null
            Entrypoint:
                - '/usr/bin/hostapd'
            HostConfig:
                CpuShares: 2048
                CapAdd:
                    - 'NET_ADMIN'
                    - 'NET_RAW'
                NetworkMode: 'host'
                Dns: null
                Binds:
                    - 'etc:/etc/hostapd:ro'

'influxdb':
    Image: 'nfnty/arch-influxdb:latest'
    UGID: 880035

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuShares: 2048
                CpuQuota: *CPU_4S
                Binds:
                    - 'etc:/etc/influxdb:ro'
                    - 'lib:/var/lib/influxdb:rw'
        'Setup':
            Entrypoint: ['/usr/bin/bash', '-c', '/usr/bin/influxd config > /etc/influxdb/config.toml']
            HostConfig:
                Binds:
                    - 'etc:/etc/influxdb:rw'

'kea':
    Image: 'nfnty/arch-kea:latest'
    UGID: 880026

    Names:
        'kea-dhcp4':
            API:
                'Normal':
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/kea-dhcp4:/dev/log:rw'
        'kea-dhcp6':
            API:
                'Normal':
                    Entrypoint: ['/usr/bin/kea-dhcp6', '-c', '/etc/kea/kea.conf']
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/kea-dhcp6:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            Hostname: null
            HostConfig:
                CpuShares: 2048
                CapAdd:
                    - 'NET_BIND_SERVICE'
                    - 'NET_RAW'
                NetworkMode: 'host'
                Dns: null
                Binds:
                    - 'etc:/etc/kea:ro'
                    - 'lib:/var/lib/kea:rw'
                Tmpfs:
                    '/run/kea': *TMP_MIB_64

'kibana':
    Image: 'nfnty/arch-kibana:latest'
    UGID: 880012

    Names:
        'kibana':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['kibana'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['kibana'] }}"

    Paths:
        'config':
            Mode: *MODE_UR
            Managed: true
        'data':
            Mode: *MODE_URW

    API:
        'Normal':
            Env:
                - 'NODE_OPTIONS=--max-old-space-size=250'
            HostConfig:
                CpuShares: 512
                CpuQuota: *CPU_4S
                Binds:
                    - 'config:/opt/kibana/config:ro'
                    - 'data:/opt/kibana/data:rw'
                Tmpfs:
                    '/tmp': *TMP_MIB_64
                Init: true

'certbot':
    Image: 'nfnty/arch-certbot:latest'
    UGID: 880002

    Paths:
        'etc':
            Mode: *MODE_URW
            Exclude:
                - 'cli.ini'
        'etc/cli.ini':
            Type: 'Regular'
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
        'log':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                NetworkMode: 'bridge'
                Dns:
                    - "{{ network['devices']['vbr_docker1']['gateway4'] }}"
                Binds:
                    - 'etc:/etc/letsencrypt:rw'
                    - 'lib:/var/lib/letsencrypt:rw'
                    - 'log:/var/log/letsencrypt:rw'
                    - '/srv/docker/nginx-proxy-wan/webroot/letsencrypt:/mnt/webroot:rw'

'lego':
    Image: 'nfnty/arch-lego:latest'
    UGID: 880003

    Paths:
        'lib':
            Mode: *MODE_URW_GR

    API:
        'Normal':
            HostConfig:
                NetworkMode: 'bridge'
                Dns:
                    - '8.8.8.8'
                    - '8.8.4.4'
                Binds:
                    - 'lib:/var/lib/letsencrypt:rw'

'logstash':
    Image: 'nfnty/arch-logstash:latest'
    UGID: 880013

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CpuQuota: *CPU_4S
                ExtraHosts:
                    - 'logstash:127.0.0.1'
                Binds:
                    - 'etc:/etc/logstash:ro'
                    - 'lib:/var/lib/logstash:rw'
                    - '/var/log/ulogd:/mnt/ulogd:ro'

'nginx':
    Image: 'nfnty/arch-nginx:latest'
    UGID: 880016

    Names:
        'nginx-proxy-wan':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['nginx-proxy-wan'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['nginx-proxy-wan'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/nginx-proxy-wan:/dev/log:rw'

        'nginx-proxy':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['nginx-proxy'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['nginx-proxy'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/nginx-proxy:/dev/log:rw'

        'nginx-mirror':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['nginx-mirror'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['nginx-mirror'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/builder/lib/pkg:/mnt/nfnty:ro'
                            - '/srv/mirror:/mnt/mirror:ro'
                            - '/srv/docker/rsyslog/run/nginx-mirror:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
            ManagedOpts:
                Filter:
                    - 'protect /ssl/dhparam.pem'
        'lib':
            Mode: *MODE_URW
        'webroot':
            Mode: *MODE_UR

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CpuQuota: *CPU_4S
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'etc:/etc/nginx:ro'
                    - 'lib:/var/lib/nginx:rw'
                    - 'webroot:/srv/http:ro'
                Tmpfs:
                    '/run/nginx': *TMP_MIB_64

'ntp':
    Image: 'nfnty/arch-ntp:latest'
    UGID: 880023

    Names:
        'ntp':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['ntp'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['ntp'] }}"

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_448
                Memory: *MIB_512
                MemorySwap: *MIB_1024
                CpuShares: 2048
                CapAdd:
                    - 'IPC_LOCK'
                    - 'NET_BIND_SERVICE'
                    - 'SYS_TIME'
                Binds:
                    - 'etc:/etc/ntp:ro'
                    - 'lib:/var/lib/ntp:rw'
                SecurityOpt:
                    - 'no-new-privileges'
                    - "seccomp={{ lookup('file', role_path + '/files/ntp/seccomp.json') }}"

'openhab':
    Image: 'nfnty/arch-openhab-telldus:latest'
    UGID: 880017

    Names:
        'openhab':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['openhab'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['openhab'] }}"

    Paths:
        'addons':
            Mode: *MODE_UR
            Managed: true
        'config':
            Mode: *MODE_UR
            Managed: true
        'etc_openhab':
            Mode: *MODE_UR
            Managed: true
        'etc_telldus':
            Mode: *MODE_UR
            Managed: true
        'lib_openhab':
            Mode: *MODE_URW
        'lib_telldus':
            Mode: *MODE_URW
        'webapps':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                Binds:
                    - 'addons:/opt/openhab/addons:ro'
                    - 'config:/opt/openhab/configurations:ro'
                    - 'etc_openhab:/opt/openhab/etc:ro'
                    - 'etc_telldus/tellstick.conf:/etc/tellstick.conf:ro'
                    - 'lib_openhab:/var/lib/openhab:rw'
                    - 'lib_telldus:/var/lib/telldus:rw'
                    - 'webapps:/opt/openhab/webapps/static:rw'
                Tmpfs:
                    '/tmp': *TMP_MIB_64_EXEC
                Devices:
                    - PathOnHost: '/dev/tellstickduo0'
                      PathInContainer: ''
                      CgroupPermissions: 'rw'

'openvpn':
    Image: 'nfnty/arch-openvpn:latest'
    UGID: 880019

    Names:
        'openvpn-admin-tcp':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static_openvpn':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['openvpn-admin-tcp'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['openvpn-admin-tcp'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/openvpn-admin-tcp:/dev/log:rw'

        'openvpn-admin-udp':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static_openvpn':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['openvpn-admin-udp'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['openvpn-admin-udp'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/openvpn-admin-udp:/dev/log:rw'

        'openvpn-home-tcp':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static_openvpn':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['openvpn-home-tcp'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['openvpn-home-tcp'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/openvpn-home-tcp:/dev/log:rw'

        'openvpn-home-udp':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static_openvpn':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['openvpn-home-udp'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['openvpn-home-udp'] }}"
                    HostConfig:
                        Binds:
                            - '/srv/docker/rsyslog/run/openvpn-home-udp:/dev/log:rw'

    Paths:
        'etc':
            Mode: *MODE_UR_GR
            Group: 'root'
            Managed: true
            ManagedOpts:
                Filter:
                    - 'protect /ssl/dhparam.pem'
                    - 'protect /ssl/ta.key'
        'lib':
            Mode: *MODE_URW_GRW
            Group: 'root'

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CpuQuota: *CPU_4S
                CapAdd:
                    - 'NET_ADMIN'
                    - 'NET_RAW'
                    - 'SETGID'
                    - 'SETUID'
                NetworkMode: 'static_openvpn'
                Sysctls:
                    'net.ipv4.ip_forward': '1'
                    'net.ipv4.conf.default.forwarding': '1'
                    'net.ipv4.conf.all.forwarding': '1'
                    'net.ipv6.conf.default.forwarding': '1'
                    'net.ipv6.conf.all.forwarding': '1'
                Dns:
                    - "{{ network['devices']['vbr_ovpn0']['gateway4'] }}"
                Binds:
                    - 'etc:/etc/openvpn:ro'
                    - 'lib:/var/lib/openvpn:rw'
                Tmpfs:
                    '/tmp': 'size=32M,nr_inodes=10K,mode=770,rw,nosuid,nodev,noexec,async,noatime,gid=0'
                Devices:
                    - PathOnHost: '/dev/net/tun'
                      PathInContainer: '/dev/net/tun'
                      CgroupPermissions: 'rw'

        'Setup':
            Entrypoint: ['/usr/bin/openvpn', '--genkey', '--secret', '/etc/openvpn/ssl/ta.key']
            HostConfig:
                Binds:
                    - 'etc:/etc/openvpn:rw'

'openvpn-cli':
    Image: 'nfnty/arch-openvpn:latest'
    UGID: 880019

    Paths:
        'etc':
            Mode: *MODE_UR_GR
            Group: 'root'
            Managed: true
        'lib':
            Mode: *MODE_URW_GRW
            Group: 'root'

    API:
        'Normal':
            Entrypoint: [
                "/usr/bin/bash", "-c",
                "/usr/bin/iptables --table nat --append POSTROUTING --out-interface tun0 --jump MASQUERADE && \
                 /usr/bin/ip6tables --table nat --append POSTROUTING --out-interface tun0 --jump MASQUERADE && \
                 exec /usr/bin/openvpn --config /etc/openvpn/client.conf"
            ]
            HostConfig:
                MemoryReservation: *MIB_896
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                CpuQuota: *CPU_4S
                CapAdd:
                    - 'NET_ADMIN'
                    - 'NET_RAW'
                    - 'SETGID'
                    - 'SETUID'
                Sysctls:
                    'net.ipv4.ip_forward': '1'
                    'net.ipv4.conf.default.forwarding': '1'
                    'net.ipv4.conf.all.forwarding': '1'
                    'net.ipv6.conf.default.forwarding': '1'
                    'net.ipv6.conf.all.forwarding': '1'
                Binds:
                    - 'etc:/etc/openvpn:ro'
                    - 'lib:/var/lib/openvpn:rw'
                Tmpfs:
                    '/tmp': 'size=32M,nr_inodes=10K,mode=770,rw,nosuid,nodev,noexec,async,noatime,gid=0'
                Devices:
                    - PathOnHost: '/dev/net/tun'
                      PathInContainer: '/dev/net/tun'
                      CgroupPermissions: 'rw'

'owncloud':
    Image: 'nfnty/arch-owncloud:latest'
    UGID: 880016

    Paths:
        'apps':
            Mode: *MODE_URW
        'data':
            Mode: *MODE_URW
        'config':
            Mode: *MODE_URW
            Managed: true
        'etc_nginx':
            Mode: *MODE_UR
            Managed: true
        'etc_php':
            Mode: *MODE_UR
            Managed: true
        'lib_nginx':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'apps:/usr/share/webapps/owncloud/apps:rw'
                    - 'config:/usrshare/webapps/owncloud/config:rw'
                    - 'data:/usr/share/webapps/owncloud/data:rw'
                    - 'etc_nginx:/etc/nginx:ro'
                    - 'etc_php:/etc/php:ro'
                    - 'lib_nginx:/var/lib/nginx:rw'
                    - '/mnt/1/share:/mnt/1:rw'
                Tmpfs:
                    '/run/nginx': *TMP_MIB_64
                    '/run/php-fpm': *TMP_MIB_64
                    '/tmp': *TMP_MIB_64

'parity':
    Image: 'nfnty/arch-parity:latest'
    UGID: 880043

    Names:
        'parity':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['parity'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['parity'] }}"

    Paths:
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            Cmd: [
                '--jsonrpc-interface', '[::]',
                '--jsonrpc-hosts', 'all',
                '--dapps-interface', '[::]',
                '--dapps-hosts', 'all',
                '--no-ui',
                '--min-peers', '128',
                '--max-peers', '256',
                '--max-pending-peers', '256',
                '--tx-queue-size', '16384',
            ]
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuShares: 256
                CpuQuota: *CPU_4S
                Binds:
                    - 'lib:/var/lib/parity:rw'

'pimd':
    Image: 'nfnty/arch-pimd:latest'
    UGID: 880030

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                CpuShares: 2048
                CapAdd:
                    - 'NET_ADMIN'
                    - 'NET_RAW'
                NetworkMode: 'host'
                Binds:
                    - 'etc/pimd.conf:/etc/pimd.conf:ro'
                Tmpfs:
                    '/var/run': *TMP_MIB_64

'postgresql':
    Image: 'nfnty/arch-postgresql:latest'
    UGID: 880018

    Names:
        'postgresql':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['postgresql'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['postgresql'] }}"

        'postgresql-acoustid':
            Image: 'nfnty/arch-postgresql-acoustid:latest'
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['postgresql-acoustid'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['postgresql-acoustid'] }}"
    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW
        'lib/data':
            Managed: true
            ManagedOpts:
                Delete: false

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CpuQuota: *CPU_4S
                Binds:
                    - 'etc:/etc/postgres:ro'
                    - 'lib:/var/lib/postgres:rw'
                Tmpfs:
                    '/run/postgresql': *TMP_MIB_64

        'Setup':
            Entrypoint: ['/usr/bin/initdb']
            HostConfig:
                Binds:
                    - 'lib:/var/lib/postgres:rw'

'powerdns-recursor':
    Image: 'nfnty/arch-powerdns-recursor:latest'
    UGID: 880024

    Names:
        'powerdns-recursor':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['powerdns-recursor'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['powerdns-recursor'] }}"

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CpuShares: 2048
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'etc:/etc/powerdns:ro'
                    - '/srv/blacklists/domain:/mnt/blacklists:ro'
                Tmpfs:
                    '/run': *TMP_MIB_64

'prometheus':
    Image: 'nfnty/arch-prometheus:latest'
    UGID: 880036

    Names:
        'prometheus':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['prometheus'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['prometheus'] }}"

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuShares: 2048
                CpuQuota: *CPU_4S
                Binds:
                    - 'etc:/etc/prometheus:ro'
                    - 'lib:/var/lib/prometheus:rw'

'radvd':
    Image: 'nfnty/arch-radvd:latest'
    UGID: 880042

    Names:
        'radvd': null

    Paths:
        'etc/radvd.conf':
            Type: 'Regular'
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            Hostname: null
            HostConfig:
                CpuShares: 2048
                CapAdd:
                    - 'NET_RAW'
                NetworkMode: 'host'
                Dns: null
                Binds:
                    - 'etc/radvd.conf:/etc/radvd.conf:ro'
                Tmpfs:
                    '/run': *TMP_MIB_64

'redis':
    Image: 'nfnty/arch-redis:latest'
    UGID: 880038

    Names:
        'redis-acoustid':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['redis-acoustid'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['redis-acoustid'] }}"

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuQuota: *CPU_4S
                Binds:
                    - 'etc/redis.conf:/etc/redis.conf:ro'
                    - 'lib:/var/lib/redis:rw'

'rspamd':
    Image: 'nfnty/arch-rspamd:latest'
    UGID: 880041

    Names:
        'rspamd':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['rspamd'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['rspamd'] }}"

    Paths:
        'etc/rspamd.conf':
            Type: 'Regular'
            Mode: *MODE_UR
            Managed: true
        'etc/override.d':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                Binds:
                    - 'etc/rspamd.conf:/etc/rspamd/rspamd.conf:ro'
                    - 'etc/override.d:/etc/rspamd/override.d:ro'
                    - 'lib:/var/lib/rspamd:rw'

'rsyslog':
    Image: 'nfnty/arch-rsyslog:latest'
    UGID: 880034

    Names:
        'rsyslog': null

    Paths:
        'etc':
            Mode: *MODE_UR
            Managed: true
        'log':
            Mode: *MODE_URW_GR
        'run':
            Mode: *MODE_URW
            Exclude: '.*'

    API:
        'Normal':
            NetworkDisabled: true
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuShares: 2048
                CpuQuota: *CPU_4S
                NetworkMode: 'none'
                Binds:
                    - 'etc/rsyslog.conf:/etc/rsyslog.conf:ro'
                    - 'log:/var/log/rsyslog:rw'
                    - 'run:/run:rw'

'samba':
    Image: 'nfnty/arch-samba:latest'
    UGID: 880014

    Paths:
        'cache':
            Mode: *MODE_URW_GR_OR
        'etc':
            Mode: *MODE_UR
            Managed: true
        'lib':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_1792
                Memory: *MIB_2048
                MemorySwap: *MIB_4096
                CapAdd:
                    - 'NET_BIND_SERVICE'
                Binds:
                    - 'cache:/var/cache/samba:rw'
                    - 'etc:/etc/samba:ro'
                    - 'lib:/var/lib/samba:rw'
                    - '/mnt/1/share:/mnt/1:rw'
                Tmpfs:
                    '/run/samba': *TMP_MIB_64

'transmission':
    Image: 'nfnty/arch-transmission:latest'
    UGID: 880010

    Names:
        'transmission':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['transmission'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['transmission'] }}"

    Paths:
        'lib':
            Mode: *MODE_URW
            Managed: true
            ManagedOpts:
                Delete: false
        'opt':
            Mode: *MODE_UR
            Managed: true

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_3840
                Memory: *MIB_4096
                MemorySwap: *MIB_8192
                CpuShares: 512
                Binds:
                    - 'lib:/var/lib/transmission:rw'
                    - 'opt:/opt/transmission:ro'
                    - '/mnt/1/share/torrent:/mnt/torrent:rw'

'unifi':
    Image: 'nfnty/arch-unifi:latest'
    UGID: 880004

    Names:
        'unifi':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['unifi'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['unifi'] }}"

    Paths:
        'conf':
            Mode: *MODE_UR
            Managed: true
        'data':
            Mode: *MODE_URW
        'logs':
            Mode: *MODE_URW
        'work':
            Mode: *MODE_URW

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_896
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                Binds:
                    - 'conf:/opt/unifi/conf:ro'
                    - 'data:/opt/unifi/data:rw'
                    - 'logs:/opt/unifi/logs:rw'
                    - 'work:/opt/unifi/work:rw'
                Tmpfs:
                    '/tmp': *TMP_MIB_64_EXEC
                    '/opt/unifi/run': *TMP_MIB_64

'znc':
    Image: 'nfnty/arch-znc:latest'
    UGID: 880044

    Names:
        'znc':
            API:
                'Normal':
                    NetworkingConfig:
                        EndpointsConfig:
                            'static':
                                IPAMConfig:
                                    IPv4Address: "{{ network['addresses4']['container']['znc'] }}"
                                    IPv6Address: "{{ network['addresses6']['container']['znc'] }}"

    Paths:
        'lib':
            Mode: *MODE_URW
            Managed: true
            ManagedOpts:
                Delete: false

    API:
        'Normal':
            HostConfig:
                MemoryReservation: *MIB_896
                Memory: *MIB_1024
                MemorySwap: *MIB_2048
                Binds:
                    - 'lib:/var/lib/znc:rw'
